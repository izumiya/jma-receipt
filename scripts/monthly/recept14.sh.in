#!/bin/bash

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

#-------------------------------------------#
#    公害レセプト作成
#        $1  SRYYM TERID SYSYMD
#        $2  SYOKBN
#            1:一括作成  2:個別作成
#        $3  RECEKBN
#            6:公害
#        $4  エラーファイル名 
#        $5  JOBID 
#        $6  SHELLID
#        $8  処理年月
#        $9  作成年月日
#        $10 作成時間
#        $16 HOSPNUM 
#        $18 レセプト作成区分
#            1:提出用レセ、2:点検用レセ、3:点検用レセ（０点公費記載）
#            4:点検用レセ（包括算定分記載）、5:点検用レセ（０点公費・包括算定分記載）
#        $19 請求データ削除区分
#            0:削除しない、2:削除する
#-------------------------------------------#

        if [ ${2} -eq  '1' ]; then
           LOG_FILE="/var/log/jma-receipt/${16}recept14a.log"
        else
           LOG_FILE="/var/log/jma-receipt/${16}recept14b.log"
        fi

        echo "arg1  = [" ${1} "]"   >$LOG_FILE
        echo "arg2  = [" ${2} "]"  >>$LOG_FILE
        echo "arg3  = [" ${3} "]"  >>$LOG_FILE
        echo "arg4  = [" ${4} "]"  >>$LOG_FILE
        echo "arg5  = [" ${5} "]"  >>$LOG_FILE
        echo "arg6  = [" ${6} "]"  >>$LOG_FILE
        echo "arg8  = [" ${8} "]"  >>$LOG_FILE
        echo "arg9  = [" ${9} "]"  >>$LOG_FILE
        echo "arg10 = [" ${10} "]" >>$LOG_FILE
        echo "arg16 = [" ${16} "]" >>$LOG_FILE
        echo "arg18 = [" ${18} "]" >>$LOG_FILE
        echo "arg19 = [" ${19} "]" >>$LOG_FILE

##      エラーファイル削除
	echo "errfile = [" ${MCP_TEMPDIR}/${4}  "]" >> $LOG_FILE
        rm  -f ${MCP_TEMPDIR}/${4}
        
        rm  -f ${MCP_TEMPDIR}/${16}00RECE9*

        
	$DBSTUB -dir $LDDIRECTORY -bd orcabt ORCR1000 -parameter $1$2$3$5$6,${18},${16},${4} >> $LOG_FILE 2>&1
        if  [ -e ${MCP_TEMPDIR}/${4} ]; then
            exit 
        else 
	        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCR1010 -parameter $1$5$6,${18},${16},${4} >> $LOG_FILE 2>&1
        fi
 
        if  [ -e ${MCP_TEMPDIR}/${4} ]; then
            exit 
        else 
	        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCR1020 -parameter $1$5$6,${16},${4} >> $LOG_FILE 2>&1
        fi

        if  [ -e ${MCP_TEMPDIR}/${4} ]; then
            exit 
        else 
	        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCR1030 -parameter $1$5$6,${16},${4} >> $LOG_FILE 2>&1
        fi
 
        if  [ -e ${MCP_TEMPDIR}/${4} ]; then
            exit 
        else 
	        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCR1040 -parameter $1$5$6,${16},${4} >> $LOG_FILE 2>&1
        fi
 
        if  [ -e ${MCP_TEMPDIR}/${4} ]; then
            exit 
        else 
	        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCR1050 -parameter $1$5$6,${18},${16},${4} >> $LOG_FILE 2>&1
        fi

        if  [ -e ${MCP_TEMPDIR}/${4} ]; then
            exit 
        else 
            $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCR1060 -parameter $9${10}$1$2$3$8$5$6,${18},${19},${16},${4} >> $LOG_FILE 2>&1
        fi
        
        if  [ -e ${MCP_TEMPDIR}/${4} ]; then
            exit 
        else
	        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter JBE$5$6,${16} >> $LOG_FILE 2>&1
        
        rm  -f ${MCP_TEMPDIR}/${16}00RECE9*
	fi
	
        exit 
