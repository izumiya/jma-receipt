#!/bin/sh

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

#-------------------------------------------#
#    レセ電ファイル作成処理
#        $1-${11} 印刷ＤＢ用固定引数
#        $12 提出先
#        $13 レセ電ファイル出力先
#        $14 JOBID 
#        $15 SHELLID
#        $16 エラーファイル名 
#        $17 ファイル出力先区分
#        $18 端末ｉｐアドレス
#-------------------------------------------#

    rennum=0

##  エラーファイル削除
	echo $#
	echo "echo " ${16}
    if  [ -e ${16} ]; then
        rm ${16}
    fi

#   レセ電ファイル作成

    $DBSTUB -dir "$LDDEFDIR"/directory -bd orcabt ORCBM500 -parameter $1,$2,$3,$rennum,$5,$6,$7,$8,$9,${10},${11},${12},${14},${15}
    if  [ -e ${16} ]; then
        exit 
    fi
        
#   症状詳記作成

    rennum=$(expr $rennum + 1) 
    $DBSTUB -dir "$LDDEFDIR"/directory -bd orcabt ORCBM510 -parameter $1,$2,$3,$rennum,$5,$6,$7,$8,$9,${10},${11},${12},${14},${15}
        
        
    if  [ -e ${16} ]; then
        exit 
    fi
        
#   漢字コード変換（ＥＵＣからシフトＪＩＳ）	
    nkf -s /var/tmp/RECE300.dat > ${13}RECEIPTC.UKE

    if  [ ${17} -eq '1' ]; then
	$FDW -host ${18} -command fd-write.sh ${13}RECEIPTC.UKE RECEIPTC.UKE
	RC=$?
	if  [ $RC -ne '0' ]; then
	    ERRCD='0000'$RC
	    $DBSTUB -dir "$LDDEFDIR"/directory -bd orcabt ORCBJOB -parameter JBE${14}${15}'  '${ERRCD:${#ERRCD}-4:4}
            exit
	fi
    fi

    if  [ ${17} -eq '2' ]; then
	$FDW -host ${18} -command mo-write.sh ${13}RECEIPTC.UKE RECEIPTC.UKE
	RC=$?
	if  [ $RC -ne '0' ]; then
	    ERRCD='0000'$RC
	    $DBSTUB -dir "$LDDEFDIR"/directory -bd orcabt ORCBJOB -parameter JBE${14}${15}'  '${ERRCD:${#ERRCD}-4:4}
            exit
	fi
    fi

    $DBSTUB -dir "$LDDEFDIR"/directory -bd orcabt ORCBJOB -parameter JBE${14}${15}

    exit 
