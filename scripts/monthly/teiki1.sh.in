#!/bin/sh

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

#-------------------------------------------#
#    定期請求データ作成
#
#        $1 SRYYM TERID SYSYMD
#        $2 SYOKBN
#           1:一括作成  2:個別作成
#        $3 KIKANST KIKANED KBN (1)
#           定期請求の期間開始日,終了日
#           有効区分（区分='1'の期間が処理対象）
#        $4 KIKANST KIKANED KBN (2)
#        $5 KIKANST KIKANED KBN (3)
#        $6 伝票発行日
#        $7 JOBID 
#        $8 SHELLID
#        $9 HOSPNUM
#        ${10} エラーファイル
#        ${11}処理対象の期別
#        ${12}処理日
#        ${13}処理時間
#-------------------------------------------#

ERR_FILE=${10}

##      エラーファイル削除
	echo $#
	echo "echo " $ERR_FILE
        if  [ -e $ERR_FILE ]; then
            rm  $ERR_FILE
        fi
    
        rm  /var/tmp/TEIKI*

##   -- ORCT0010 START --  
        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCT0010 -parameter "$1,$2,$3,$4,$5,$6,$7,$8,$9,${10},${11},${12},${13}"
        if  [ -e $ERR_FILE ]; then
            exit  
        fi

##   -- ORCT0030 START --  
        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCT0030 -parameter "$1,$2,$3,$4,$5,$6,$7,$8,$9,${10},${11},${12},${13}"
        if  [ -e $ERR_FILE ]; then
            exit  
        fi 

##   -- ORCT0060 START --  
        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCT0060 -parameter "$1,$2,$3,$4,$5,$6,$7,$8,$9,${10},${11},${12},${13}"
        if  [ -e $ERR_FILE ]; then
            exit  
        fi 

##   -- ORCT0040 START --  
        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCT0040 -parameter "$1,$2,$3,$4,$5,$6,$7,$8,$9,${10},${11},${12},${13}"
        if  [ -e $ERR_FILE ]; then
            $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCT0050 -parameter "$9,$7,$8,${10}"
            exit  
        fi 

        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter JBE$7$8,$9

        exit
