#!/bin/bash

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

RENNUM=0
#-------------------------------------------#
#    日次統計出力処理
#        $1-${11} 印刷ＤＢ用固定引数
#        ${12} ジョブＩＤ
#        ${13} シェルＩＤ
#        ${14} 医療機関番号 
#        ${15} エラーファイル名 
#        ${16} PRGRAMID   X(08)
#        ${17} PARA (1)   X(20)
#        ${18} PARA (2)   X(20)
#        ${19} PARA (3)   X(20)
#        ${20} PARA (4)   X(20)
#        ${21} PARA (5)   X(20)
#        ${22} PARA (6)   X(20)
#        ${23} PARA (7)   X(20)
#        ${24} PARA (8)   X(20)
#-------------------------------------------#
##

ERR_FILE=${15}
HOSPNUM=${14}
LD=051

if [ ${13} = 'MONTHLY' ]; then
  LD=052
fi

OLDLOG=/home/orca/execoprg.log
LOGFILE=/var/log/jma-receipt/${HOSPNUM}orcb${LD}.log

##      旧ログファイルを削除
        if  [ -e $OLDLOG ]; then
            rm  $OLDLOG
        fi

	echo $#
##      エラーファイル削除
	echo "echo " $ERR_FILE
        if  [ -e $ERR_FILE ]; then
            rm  $ERR_FILE
        fi
##
        RENNUM=$(expr $RENNUM + 1) 
	$DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBLMAIN -parameter "${16},$1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${12},${13},${14},${15},${17},${18},${19},${20},${21},${22},${23},${24},"  > $LOGFILE 2>&1

        if  [ -e $ERR_FILE ]; then
            exit
        fi
       
       $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter "JBE${12}${13},${14}"
        exit 
