#!/bin/sh

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

#-------------------------------------------#
#    日次統計データ作成
#        $1  TERMID 
#        $2  HOSPID
#        $3  HOSPCD   
#        $4  県番号
#        $5  SRYYM 
#        $6  NYUGAIKBN 
#        $7  FILENM1
#        $8  FILENM2 
#        $9  DATAKBN
#        ${10} HOUKATUKBN
#        ${11} KOJINKBN
#        ${12} CDKBN
#        ${13} JOBID
#        ${14} SHELLID
#        ${15} ERRFILENM
#        ${16} ファイル出力先区分（診療）
#        ${17} ファイル出力先区分（病名）
#        ${18} 端末ｉｐアドレス
#-------------------------------------------#
##      エラーファイル削除
	echo $#
        if  [ -e ${15} ]; then
            rm  ${15}
        fi
        
        rm  /var/tmp/TOKEI1*
        
        if  [ ${6} -eq '2' ]; then
	    $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBT110 -parameter $1,$2,$4,$5,$6,$9,${10},${13},${14},${15} > /home/orca/toukei2.log
        else
	    $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBT120 -parameter $1,$2,$4,$5,$6,$9,${10},${13},${14},${15} > /home/orca/toukei2.log
        fi
        
        if  [ -e ${15} ]; then
            exit 
        else
	        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBT130 -parameter $1,${11},${13},${14},${15} >> /home/orca/toukei2.log
	    fi

        if  [ -e ${15} ]; then
            exit 
        fi

#       漢字コード変換（ＥＵＣからシフトＪＩＳ）

        if  [ ${12} -eq '2' ]; then
            nkf -s /var/tmp/toukei11.dat > /tmp/$7
        else
            cp  /var/tmp/toukei11.dat /tmp/$7 
        fi
#
         case ${16} in
                  1) 	$FDW -host ${18} -command fd-write.sh /tmp/$7 $7
			RC=$?
                        ;;
                  2) 	$FDW -host ${18} -command mo-write.sh /tmp/$7 $7
			RC=$?
                        ;;
                  3) 	$FDW -host ${18} -command user1-write.sh /tmp/$7 $7
			RC=$?
                        ;;
                  4) 	$FDW -host ${18} -command user2-write.sh /tmp/$7 $7
			RC=$?
                        ;;
                  5) 	$FDW -host ${18} -command user3-write.sh /tmp/$7 $7
			RC=$?
                        ;;
         esac
	     if  [ $RC -ne '0' ]; then
		    ERRCD='0000'$RC
        	$DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter JBE${13}${14}'  '${ERRCD:${#ERRCD}-4:4} >> /home/orca/toukei2.log
        else
            $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter JBE${13}${14} >> /home/orca/toukei2.log
        fi
        exit 
