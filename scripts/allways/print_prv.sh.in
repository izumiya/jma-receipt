#!/bin/bash

JMARECEIPT_ENV="@jma-receipt-env@"
if [ ! -f ${JMARECEIPT_ENV} ]; then
    echo "${JMARECEIPT_ENV} does not found."
    exit 1
fi
. $JMARECEIPT_ENV
#if ! test -d /var/tmp/.orca_ps ; then
#    mkdir /var/tmp/.orca_ps
#fi

#-------------------------------------------#
#    °õºþ£Ä£Â¤«¤é¤Î°õºþ½èÍý
#        $1-${11} °õºþ£Ä£ÂÍÑ¸ÇÄê°ú¿ô
#        ${12} ¥¨¥é¡¼¥Õ¥¡¥¤¥ëÌ¾ 
#        ${13} ¥¸¥ç¥Ö£É£Ä
#        ${14} ¥·¥§¥ë£É£Ä
#        ${15} °õºþ³«»ÏÊÇ
#        ${16} °õºþ½ªÎ»ÊÇ
#        ${17} ½ÐÎÏ¶èÊ¬ 1:°õºþ¤Î¤ß 2:°õºþ¡õps 3:ps¤Î¤ß
#        ${18} HOSPNUM
#        ${19} UUID
#        ${20} GYOUMU-CD
#        ${21} °õºþ¥Ç¡¼¥¿(¥ª¥ê¥¸¥Ê¥ë)
#        ${22} ¥¯¥é¥¤¥¢¥ó¥È°õºþ¥À¥¤¥¢¥í¥°É½¼¨
#-------------------------------------------#
#
termtrap () {
  echo "term trap in ${0}."
  $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter "JBE${13}${14},${18}"
  exit 1
}

trap 'termtrap "$@"' TERM

PID=`printf "%05d" $$`
$DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter "PID${13}${14},${18},${PID}"
$DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter "PPD${13}${14},${18},${R_PID}"

ERR_FILE_BASE=${12}
ERR_FILE_FULL=${MCP_TEMPDIR}/${ERR_FILE_BASE}

PRT_FILE_BASE=${21}
PRT_FILE_FULL=${MCP_TEMPDIR}/${PRT_FILE_BASE}

##      ¥¨¥é¡¼¥Õ¥¡¥¤¥ëºï½ü
	echo $#
	echo "echo " ${ERR_FILE_FULL}
	echo "echo " ${PRT_FILE_FULL}
        if  [ -e ${ERR_FILE_FULL} ]; then
            rm  ${ERR_FILE_FULL}
        fi
        
        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBPRT1 -parameter $1,$2,$3,$4,$5,$6,$7,$8,$9,${10},${11},${ERR_FILE_BASE},${13},${14},${15},${16},${17},${18},${19},${20},${PRT_FILE_BASE},${22}
        if  [ -e ${12} ]; then
            exit
        else
	    $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter JBE${13}${14},${18}
	fi
#


        exit 

