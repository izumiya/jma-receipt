#!/bin/bash

if test -z "$JMARECEIPT_ENV"; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

umask 022

PRGDIR=/var/tmp/orca-prg@VERSION@
PATCHDIR=/var/lib/jma-receipt/patch
PACKAGEFILE=patch@VERSION@.gz
PRGPATH=$PGUPGRADEPATH/@VERSION@
PATCHLIST=$PATCHDIR/patch-file-list
CACERTFILE=/etc/ssl/certs/orca-project-ca-1.crt


#オフラインメンテナンスであるかチェック
OFFLINEPATH=`echo $PRGPATH | sed -ne 's#file://##p'`
if [ -z $OFFLINEPATH ]; then
  OFFLINE="online"
else
  OFFLINE="offline"
  PRGPATH=$OFFLINEPATH
fi

if ! [ -d $PATCHDIR ];	then
	echo "パッチディレクトリが存在しません"
	exit
fi

export PACKAGEFILE
export PATCHDIR
export PRGPATH
export CACERTFILE
export PATCHLIST

#更新プログラムダウンロード
cachedl.rb 2>&1

exit
