      *******************************************************************
      * Project code name "ORCA"
      * 日医標準レセプトソフト（JMA standard receipt software）
      * Copyright(C) 2002 JMA (Japan Medical Association)
      *
      * This program is part of "JMA standard receipt software".
      *
      *     This program is distributed in the hope that it will be useful
      * for further advancement in medical care, according to JMA Open
      * Source License, but WITHOUT ANY WARRANTY.
      *     Everyone is granted permission to use, copy, modify and
      * redistribute this program, but only under the conditions described
      * in the JMA Open Source License. You should have received a copy of
      * this licence along with this program. If not, stop using this
      * program and contact JMA, 2-28-16 Honkomagome, Bunkyo-ku, Tokyo,
      * 113-8621, Japan.
      ********************************************************************
      *
       IDENTIFICATION          DIVISION.
       PROGRAM-ID.             ORCR0500.
      *****************************************************************
      *  システム名        : ＯＲＣＡ
      *  サブシステム名    : 月次帳票
      *  コンポーネント名  : 労災レセプト帳票ＤＢの印刷
      *  管理者            : 
      *  作成日付    作業者        記述
      *  00/12/01    MCC-藤原      新規作成
      *****************************************************************
      *  プログラム修正履歴
      * Maj/Min/Rev  修正者       日付      内容
      *  01.00.01    NACL-藤原    02/09/12  ディレクトリをサブプロへ
      *  01.00.02    NACL-藤原    02/09/27  帳票ＩＤをＤＢより編集
      *                                     パラメタに入外区分の追加
      *  01.00.03    NACL-藤原    02/10/21  印刷用ファイルにサイト区分を追加
      *  01.00.04    NACL-藤原    03/01/10  印刷順通し番号を追加
      *  01.00.05    NACL-門脇    03/01/31  事業所名の長さ変更のため
      *                                     帳票ＩＤ追加
      *  01.00.06    NACL-門脇    03/02/12  医療機関名の長さ変更のため
      *                                     帳票ＩＤ追加
      *  01.00.07    NACL-藤原    03/02/14  頁数のジョブ管理ＤＢへの更新
      *  01.00.08    NACL-藤原    03/02/24  プリンタ名をオンラインより渡す
      *  01.00.09    NACL-藤原    03/03/03  再印刷機能のためにパラメタを追加
      *
      *  労災・自賠責入院機能追加
      *  01.01.01    NACL-藤原    03/07/20  労災・自賠責の入院帳票ＩＤ追加
      *  01.01.02    NACL-門脇    04/01/26  カナ氏名の長さ等修正
      *                                     HCM22V02.REDを追加
      *                                     HCM24V02.REDを追加
      *                                     HCM21V02.REDを追加
      *                                     HCM18V02.REDを追加
      *                                     HCM20V02.REDを追加
      *                                     HCM23V02.REDを追加
      *                                     HCM29V01.REDを追加
      *                                     HCN22V01.REDを追加
      *                                     HCN21V01.REDを追加
      *                                     HCN23V01.REDを追加
      *
      *  ２００４年４月改正
      *  01.02.01    NACL-藤原    04/03/29  請求点の桁数の変更
      *                                     HCN21V02.red
      *                                     HCN22V02.red
      *                                     HCN23V02.red
      *  01.02.02    NACL-藤原    04/09/13  医療機関名称・所在地の長さを
      *                                     変更
      *
      *  中止処理追加
      *  01.05.01    NACL-藤原    04/12/01  印刷中止処理の追加
      *
      *  02.06.01    NACL-藤原    05/06/22 自賠責レセプトの様式追加
      *                                     HCM25.red
      *                                     HCM26.red
      *                                     HCN25.red
      *  02.06.02    NACL-藤原    05/09/05  複数枚レセの連番記載
      *                                     HCM18V04.red
      *                                     HCM20V04.red
      *                                     HCM21V04.red
      *                                     HCM22V04.red
      *                                     HCM24V04.red
      *                                     HCM29V02.red
      *                                     HCN22V04.red
      *                                     HCN21V04.red
      *  03.00.01    NACL-太田    06/06/19  PRT-PRTDATAの項目長変更
      *                                     (10000->20000)
      *
      *  03.02.01    NACL-藤原    06/07/11  労災・自賠責のプリンタ指定対応
      *                                     （入院外・入院別）
      *  03.02.02    NACL-藤原    06/07/24  自賠責の枠印刷選択機能対応
      *                                     HCM48.red
      *                                     HCN48.red
      *                                     HCM49.red
      *
      *  03.02.01    NACL-藤原    06/08/01  国保主科対応
      *                                     主科用出力順識別番号追加
      *
      *  03.03.01    NACL-藤原    06/10/13  ２００６年１０月改正対応
      *                                     労災（入院）
      *                                     HCN50.red
      *                                     HCN51.red
      *****************************************************************
      *
       ENVIRONMENT             DIVISION.
       CONFIGURATION               SECTION.
       INPUT-OUTPUT                SECTION.
       FILE-CONTROL.
      *
      *    印刷用データ
           SELECT  PRT-FILE        ASSIGN  HC01PARA
                                   ORGANIZATION    IS  LINE
                                                       SEQUENTIAL 
                                   FILE    STATUS  IS  STS-PRT.
      *
      *    エラーファイル
           SELECT  RECEERR-FILE    ASSIGN  RECEERR
                                   FILE    STATUS  IS  STS-RECEERR.
      *
       DATA                        DIVISION.
       FILE                        SECTION.
      *
      *    印刷用データ
       FD  PRT-FILE.
       01  PRT-REC.
           03  PRT-PRTID           PIC X(30).
           03  PRT-PRTNM           PIC X(20).
           03  PRT-OFFSET-X        PIC X(05).
           03  PRT-OFFSET-Y        PIC X(05).
           03  PRT-SITEKBN         PIC X(01).
           03  PRT-PRTKBN          PIC X(01).
           03  PRT-OUT             PIC X(165).
           03  PRT-TBL-KEY         PIC X(08).
           03  PRT-RENNUM          PIC 9(04).
           03  PRT-TBL-GROUP       PIC X(14).
           03  PRT-SHORI-RENNUM    PIC 9(04).
           03  PRT-PAGE            PIC 9(05).
           03  PRT-PRTDATA         PIC X(20000).
      *
      *    エラーファイル
       FD  RECEERR-FILE.
       01  RECEERR-REC             PIC X(200). 
      *
       WORKING-STORAGE             SECTION.
grpsys*
grpsys COPY    "COMMON-SPA".
      *
      *    印刷用データ 名称領域 
           COPY    "CPCOMMONPRT.INC".
      *
      *    エラーファイル 名称領域 
           COPY    "CPCOMMONDAT2.INC"
                                   REPLACING  //RECE01PARA//
                                   BY         //RECEERR//.
           03  FILLER              PIC X(04)   VALUE   ".dat".
      *    シェル用領域
      *****COPY    "CPCOMMONSHELL.INC".
      *
      *    システム領域
       01  SYS-AREA.
           03  SYS-TIME            PIC 9(08).    
      *
      *    スパ領域
       01  STS-AREA.
           03  STS-PRT             PIC X(02).
           03  STS-RECEERR         PIC X(02).
      *
      *    フラグ領域
       01  FLG-AREA.
           03  FLG-END             PIC 9(01).
           03  FLG-SYSKANRI        PIC 9(01).
           03  FLG-RECEPRT         PIC 9(01).
      *
      *    カウント領域
       01  CNT-AREA.
           03  CNT-IN              PIC 9(04).
           03  CNT-IN-CANCEL       PIC 9(06).
           03  CNT-OUT             PIC 9(04).
      *
      *    一時領域
       01  WRK-AREA.
           03  WRK-RECEERR             PIC X(200). 
      *
           03  WRK-PATH                PIC X(64). 
      *
      *    通し番号
           03  WRK-RENNUM              PIC 9(05).
      *
      *    通し番号編集エリア
           03  WRK-HEN-RENNUM-AREA.
               05  WRK-HEN-RENNUM1     PIC ZZZZZZ9.
               05  WRK-HEN-RENNUM-R    REDEFINES   WRK-HEN-RENNUM1.   
                   07  FILLER          PIC X(01).
                   07  WRK-HEN-FL1     PIC X(01).
                   07  WRK-HEN-RENNUM2 PIC ZZZ9.
                   07  WRK-HEN-FL2     PIC X(01).
      *
           03  WRK-PARA.
               05  WRK-PARA-JOBID                PIC 9(07).
               05  WRK-PARA-SHELLID              PIC X(08).
               05  WRK-PARA1.  
                   07  WRK-PARA-SRYYM            PIC X(06).
                   07  WRK-PARA-TERMID           PIC X(16).
                   07  WRK-PARA-SYSYMD           PIC X(08).
               05  WRK-PARA-RECE09-KEY. 
                   07  WRK-PARA-RECE09-PRTID     PIC X(04).
                   07  WRK-PARA-RECE09-SRYYM     PIC X(06).
                   07  WRK-PARA-RECE09-CREYMD    PIC X(08).
                   07  WRK-PARA-RECE09-CREHMS    PIC X(06).
                   07  WRK-PARA-RECE09-PREFKBN   PIC X(01).
                   07  WRK-PARA-RECE09-TEISYUTUSAKI
                                                 PIC X(01).
                   07  WRK-PARA-RECE09-RECESYUBETU
                                                 PIC X(04).
                   07  WRK-PARA-RECE09-NYUGAIKBN PIC X(01).                              
               05  WRK-PARA-TERMID64             PIC X(64).
               05  WRK-PARA-SYOKBN               PIC X(01).
               05  WRK-PARA-PRTNM                PIC X(16).
               05  WRK-PARA-PRTKBN               PIC X(01). 
      *
           COPY    "CPORCSPRTLNK.INC".
      *
      *    労災レセプト
           COPY    "HCM21.INC".
           COPY    "HCM21V01.INC".
           COPY    "HCM21V02.INC".
           COPY    "HCM21V03.INC".
           COPY    "HCM21V04.INC".
           COPY    "HCM22.INC".
           COPY    "HCM22V01.INC".
           COPY    "HCM22V02.INC".
           COPY    "HCM22V03.INC".
           COPY    "HCM22V04.INC".
           COPY    "HCM24.INC".
           COPY    "HCM24V01.INC".
           COPY    "HCM24V02.INC".
           COPY    "HCM24V03.INC".
           COPY    "HCM24V04.INC".
           COPY    "HCM18.INC".
           COPY    "HCM18V01.INC".
           COPY    "HCM18V02.INC".
           COPY    "HCM18V03.INC".
           COPY    "HCM18V04.INC".
           COPY    "HCM20.INC".
           COPY    "HCM20V01.INC".
           COPY    "HCM20V02.INC".
           COPY    "HCM20V03.INC".
           COPY    "HCM20V04.INC".
      *
           COPY    "HCN21.INC".
           COPY    "HCN21V01.INC".
           COPY    "HCN21V02.INC".
           COPY    "HCN21V03.INC".
           COPY    "HCN21V04.INC".
           COPY    "HCN22.INC".
           COPY    "HCN22V01.INC".
           COPY    "HCN22V02.INC".
           COPY    "HCN22V03.INC".
           COPY    "HCN22V04.INC".
           COPY    "HCN50.INC".
           COPY    "HCN51.INC".
      *
      *    自賠責レセプト
           COPY    "HCM23.INC".
           COPY    "HCM23V01.INC".
           COPY    "HCM23V02.INC".
           COPY    "HCM23V03.INC".
           COPY    "HCM23V04.INC".
           COPY    "HCM29.INC".
           COPY    "HCM29V01.INC".
           COPY    "HCM29V02.INC".
           COPY    "HCM25.INC".
           COPY    "HCM26.INC".
           COPY    "HCM48.INC".
           COPY    "HCM49.INC".
      *
           COPY    "HCN23.INC".
           COPY    "HCN23V01.INC".
           COPY    "HCN23V02.INC".
           COPY    "HCN23V03.INC".
           COPY    "HCN23V04.INC".
           COPY    "HCN25.INC".
           COPY    "HCN48.INC".
      *
      *    ファイルデイレクトリ位置指定サブ
           COPY  "CPMKPASS.INC".
      *
           COPY    "CPSHELLTBL.INC".
      *     
           COPY    "ORCA-DBPATH".         
      *
      *****************************************************************
      *    ファイルレイアウト
      *****************************************************************
      *
      *    ジョブ管理マスタ
       01  JOBKANRI-REC.
           COPY    "CPJOBKANRI.INC".
      *     
      *    レセプト印刷情報
           COPY    "CPSK2005.INC".
      *
           COPY    "CPRCF008.INC".
      *
      *    オフセット情報
           COPY    "CPSK1044.INC".
      *
       01  PRTKANRI-REC.
           COPY    "CPPRTKANRI.INC".
      *
       01  PRTDATA-REC.
           COPY    "CPPRTDATA.INC".          
      *
      *****************************************************************
      *    サブプロ用　領域
      *****************************************************************
      *
      *   日付変換サブ
           COPY    "CPORCSDAY.INC".
           COPY    "CPORCSLNK.INC".
      *
      *   ジョブ管理ＤＢ制御サブ
           COPY    "CPORCSJOBKANRI.INC".
      *
      *    印刷ＤＢ更新サブ
           COPY    "CPORCSPRT.INC".          
      *
      *    ＤＢ検索
           COPY    "MCPAREA".
      *
           COPY    "MCPDATA.INC".
           COPY    "CPORCMCP.INC".
      *
      ****************************************************************
       LINKAGE                 SECTION.
       01  COMMAND-PARAM.
           02  FILLER      PIC X(2000).
      ****************************************************************
       PROCEDURE           DIVISION
               USING
           COMMAND-PARAM.
      *
      *****************************************************************
      *    主　　処理
      *****************************************************************
       000-PROC-SEC                SECTION.
      *
           PERFORM 100-INIT-SEC
      *
           PERFORM 200-MAIN-SEC
                   UNTIL       FLG-END     =   1
      *
           PERFORM 300-END-SEC
      *
           STOP    RUN
           .
      *****************************************************************
      *    初期　処理
      *****************************************************************
       100-INIT-SEC                SECTION.
      * 
      *
           INITIALIZE                  FLG-AREA
           INITIALIZE                  STS-AREA
           INITIALIZE                  WRK-AREA
           INITIALIZE                  CNT-AREA
      *
           ACCEPT  SYS-TIME            FROM    TIME     
      *
           UNSTRING    COMMAND-PARAM   DELIMITED  BY  ","
                                       INTO  WRK-PARA-JOBID
                                             WRK-PARA-SHELLID
                                             WRK-PARA1
                                             WRK-PARA-RECE09-KEY
                                             WRK-PARA-TERMID64
                                             WRK-PARA-SYOKBN
      ***************************************WRK-PARA-PRTNM
                                             LNK-PRTKANRI-RENNUM
                                             LNK-PRTKANRI-TBL-KEY
                                             LNK-PRTKANRI-TBL-GROUP
                                             LNK-PRTKANRI-SHORI-RENNUM
                                             LNK-PRTKANRI-SRYYM
                                             LNK-PRTKANRI-SKYYMD
                                             LNK-PRTKANRI-SHELLID
                                             LNK-PRTKANRI-PRIORITY
                                             LNK-PRTKANRI-TERMID
                                             LNK-PRTKANRI-OPID    
                                             LNK-PRTKANRI-PRTNM
                                             WRK-PARA-PRTKBN
           END-UNSTRING                                  
      *
           MOVE    "RECEERR"           TO  RECEERR-FILE-ID
           MOVE    WRK-PARA-TERMID     TO  RECEERR-TERMID
      *
           PERFORM 100-DBOPEN-SEC
      *
      *    ステップ管理開始処理
           MOVE    "STS"           TO  SJOBKANRI-MODE
           INITIALIZE                  JOBKANRI-REC
           MOVE    WRK-PARA-JOBID  TO  JOB-JOBID
           MOVE    WRK-PARA-SHELLID
                                   TO  JOB-SHELLID
           MOVE    "ORCR0500"      TO  JOB-PGID
           MOVE    "レセプト印刷処理"
                                   TO  JOB-SHELLMSG
           CALL    "ORCSJOB"       USING
                                   ORCSJOBKANRIAREA  
                                   JOBKANRI-REC
      *    処理中止設定処理
           PERFORM 500-CANCEL-HENSYU-SEC
      *
           IF      FLG-END             =   ZERO
      *        レセプト通し番号情報処理
               PERFORM 110-SYSKANRI-HENSYU-SEC
      *
               MOVE    "HC21"              TO  HC01PARA-FORM-ID
               MOVE    LNK-PRTKANRI-TERMID TO  HC01PARA-TERMID
               MOVE    SYS-TIME            TO  HC01PARA-SYOHMS
               MOVE    1                   TO  HC01PARA-CNT
           END-IF
           .
       100-INIT-EXT.
           EXIT.
      *
      *****************************************************************
      *    レセプト通し番号情報処理
      *****************************************************************
       110-SYSKANRI-HENSYU-SEC                   SECTION.
      *
      *    レセプト印刷情報編集
           MOVE    SPACE               TO  SYS-2005-REC
           INITIALIZE                  SYS-2005-REC
           MOVE    "2005"              TO  SYS-2005-KANRICD
           MOVE    "*"                 TO  SYS-2005-KBNCD
grpsys*    MOVE SPA-HOSPNUM TO -HOSPNUM
           MOVE    SYS-2005-REC        TO  MCPDATA-REC
           PERFORM 800-SYSKANRI-READ-SEC
           IF      FLG-SYSKANRI        =   ZERO
               MOVE    MCPDATA-REC         TO  SYS-2005-REC
           ELSE    
               INITIALIZE                  SYS-2005-REC
           END-IF
           .
       110-PARA-HENSYU-EXT.
           EXIT.
      *
      *
      *****************************************************************
      *    主　　処理
      *****************************************************************
       200-MAIN-SEC                SECTION.
      *
      *    処理中止設定処理
           PERFORM 500-CANCEL-HENSYU-SEC
           IF      FLG-END             =   1
               GO  TO  200-MAIN-EXT
           END-IF
      *
      *    通し番号初期値設定
           MOVE    ZERO                TO  WRK-RENNUM 
      *
           MOVE    SPACE               TO  WRK-HEN-RENNUM-AREA
           IF      WRK-PARA-SYOKBN     =   "2"
               MOVE    "["                 TO  WRK-HEN-FL1
               MOVE    "]"                 TO  WRK-HEN-FL2
           END-IF              
      *
      *    帳票印刷処理
      *
           OPEN    OUTPUT              PRT-FILE
      *
      *****MOVE    "RECEPRT-KEY3"      TO  WRK-PATH
           MOVE    "RECEPRT-KEY12"     TO  WRK-PATH
           PERFORM 900-RECEPRT-SELECT-SEC
      *
           PERFORM 2001-RECEPRT-PRINT-SEC
                                       UNTIL   FLG-RECEPRT  =   1
      *
      *****MOVE    "RECEPRT-KEY3"      TO  WRK-PATH
           MOVE    "RECEPRT-KEY12"     TO  WRK-PATH
           PERFORM 900-RECEPRT-CLS-SEC
      *
           CLOSE                       PRT-FILE
      *
      *    帳票クリア処理
      *****MOVE    "RECEPRT-KEY4"      TO  WRK-PATH
           MOVE    "RECEPRT-KEY13"     TO  WRK-PATH
           PERFORM 900-RECEPRT-SELECT-SEC
      *
           PERFORM 2002-RECEPRT-CLEAR-SEC
                                       UNTIL   FLG-RECEPRT  =   1
      *
      *****MOVE    "RECEPRT-KEY4"      TO  WRK-PATH
           MOVE    "RECEPRT-KEY13"     TO  WRK-PATH
           PERFORM 900-RECEPRT-CLS-SEC
      *
      *    処理中止設定処理
           IF      FLG-END             =   1
               GO  TO  200-MAIN-EXT
           END-IF
      *
      *    処理中止設定処理
           PERFORM 500-CANCEL-HENSYU-SEC
           IF      FLG-END             =   1
               GO  TO  200-MAIN-EXT
           END-IF
      *
      *   印刷用スクリプト処理
      *
           IF      CNT-OUT             >   ZERO 
      *
               MOVE    SPACE           TO  SHELLTBL
      *        ファイルデイレクトリ位置指定
               INITIALIZE              ORCSMKPASSAREA
      *********MOVE    "scripts/daily/HCALL2.sh"
               MOVE    "scripts/daily/HCALL_prv.sh"
                                       TO  MKPASS-IN-01
               CALL    "ORCSMKPASS"    USING   ORCSMKPASSAREA
               MOVE    MKPASS-OT-01    TO  SHELLTBL-NAME
      *         
               MOVE    HC01PARA        TO  SHELLTBL-ARG1
grpsys*        MOVE SPA-HOSPNUM TO -HOSPNUM
               MOVE    SHELLTBL        TO  MCPDATA-REC
               MOVE    "SHELL"         TO  MCP-FUNC
               MOVE    PATH-SHELL-SHELL
                                       TO  MCP-PATH
               CALL    "MCPSUB"        USING
                                           MCPAREA
                                           MCPDATA-REC
      *
      *        処理中止設定処理
               PERFORM 500-CANCEL-HENSYU-SEC
      *
      *        最新以外の帳票管理ＤＢを削除
               MOVE    SPACE           TO  PRTKANRI-REC
               INITIALIZE                  PRTKANRI-REC
               MOVE    LNK-PRTKANRI-PRIORITY
                                       TO  PRTKANRI-PRIORITY
               MOVE    LNK-PRTKANRI-TBL-GROUP
                                       TO  PRTKANRI-TBL-GROUP
grpsys*        MOVE SPA-HOSPNUM TO -HOSPNUM
               MOVE    PRTKANRI-REC    TO  MCPDATA-REC
               MOVE    "DBDELETE"      TO  MCP-FUNC
               IF      WRK-PARA-SYOKBN     =   "1"
                   MOVE    PATH-TBL-PRTKANRI-DEL12
                                           TO  MCP-PATH
               ELSE
                   MOVE    PATH-TBL-PRTKANRI-DEL13
                                           TO  MCP-PATH
               END-IF
               CALL    "MCPSUB"            USING
                                           MCPAREA
                                           MCPDATA-REC
      *
      *        最新以外の帳票ＤＢを削除
               MOVE    SPACE           TO  PRTDATA-REC
               INITIALIZE                  PRTDATA-REC
               MOVE    LNK-PRTKANRI-PRIORITY
                                       TO  PRTDATA-PRIORITY
               MOVE    LNK-PRTKANRI-TBL-GROUP
                                       TO  PRTDATA-TBL-GROUP
grpsys*        MOVE SPA-HOSPNUM TO -HOSPNUM
               MOVE    PRTDATA-REC     TO  MCPDATA-REC
               MOVE    "DBDELETE"      TO  MCP-FUNC
               IF      WRK-PARA-SYOKBN     =   "1"
                   MOVE    PATH-TBL-PRTDATA-DEL12
                                           TO  MCP-PATH
               ELSE
                   MOVE    PATH-TBL-PRTDATA-DEL13
                                           TO  MCP-PATH
               END-IF
               CALL    "MCPSUB"            USING
                                           MCPAREA
                                           MCPDATA-REC
           END-IF                                                
      *
           MOVE    1                   TO  FLG-END     
           .
       200-MAIN-EXT.
           EXIT.
      *
      *
      *****************************************************************
      *    帳票印刷処理
      *****************************************************************
       2001-RECEPRT-PRINT-SEC          SECTION.
      * 
           MOVE    SPACE               TO  PRT-REC 
           MOVE    RECE08-FORMID       TO  PRT-PRTID
           MOVE    RECE08-PRTNM        TO  PRT-PRTNM
      *
      *    オフセット
           PERFORM 2002-OFFSET-GET-SEC
           MOVE    SYS-1044-OFFSET-X   TO  PRT-OFFSET-X
           MOVE    SYS-1044-OFFSET-Y   TO  PRT-OFFSET-Y
      *
           MOVE    "1"                 TO  PRT-SITEKBN
           MOVE    WRK-PARA-PRTKBN     TO  PRT-PRTKBN
           MOVE    "/var/tmp/.orca_ps/"
                                       TO  PRT-OUT
           MOVE    LNK-PRTKANRI-TBL-KEY
                                       TO  PRT-TBL-KEY
           MOVE    LNK-PRTKANRI-RENNUM TO  PRT-RENNUM
           MOVE    LNK-PRTKANRI-TBL-GROUP
                                       TO  PRT-TBL-GROUP
           MOVE    LNK-PRTKANRI-SHORI-RENNUM
                                       TO  PRT-SHORI-RENNUM
           ADD     1                   TO  WRK-RENNUM
           MOVE    WRK-RENNUM          TO  PRT-PAGE
      *
      *    通し番号印刷のときのみ編集
           IF      SYS-2005-RENNUMHENKBN   =   "1"
               IF      WRK-PARA-SYOKBN     =   "1"
                   MOVE    WRK-RENNUM          TO  WRK-HEN-RENNUM1
               ELSE
                   MOVE    WRK-RENNUM          TO  WRK-HEN-RENNUM2
               END-IF        
      *         
               EVALUATE    RECE08-FORMID
                   WHEN    "HCM21.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM21
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM21-RENNUM
                       MOVE    HCM21               TO  RECE08-PRTDATA
                   WHEN    "HCM21V01.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM21V01
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM21V01-RENNUM
                       MOVE    HCM21V01            TO  RECE08-PRTDATA
                   WHEN    "HCM21V02.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM21V02
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM21V02-RENNUM
                       MOVE    HCM21V02            TO  RECE08-PRTDATA
                   WHEN    "HCM21V03.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM21V03
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM21V03-RENNUM
                       MOVE    HCM21V03            TO  RECE08-PRTDATA
                   WHEN    "HCM21V04.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM21V04
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM21V04-RENNUM
                       MOVE    HCM21V04            TO  RECE08-PRTDATA
                   WHEN    "HCM22.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM22
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM22-RENNUM
                       MOVE    HCM22               TO  RECE08-PRTDATA
                   WHEN    "HCM22V01.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM22V01
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM22V01-RENNUM
                       MOVE    HCM22V01            TO  RECE08-PRTDATA
                   WHEN    "HCM22V02.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM22V02
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM22V02-RENNUM
                       MOVE    HCM22V02            TO  RECE08-PRTDATA
                   WHEN    "HCM22V03.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM22V03
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM22V03-RENNUM
                       MOVE    HCM22V03            TO  RECE08-PRTDATA
                   WHEN    "HCM22V04.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM22V04
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM22V04-RENNUM
                       MOVE    HCM22V04            TO  RECE08-PRTDATA
                   WHEN    "HCM24.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM24
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM24-RENNUM
                       MOVE    HCM24               TO  RECE08-PRTDATA
                   WHEN    "HCM24V01.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM24V01
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM24V01-RENNUM
                       MOVE    HCM24V01            TO  RECE08-PRTDATA
                   WHEN    "HCM24V02.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM24V02
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM24V02-RENNUM
                       MOVE    HCM24V02            TO  RECE08-PRTDATA
                   WHEN    "HCM24V03.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM24V03
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM24V03-RENNUM
                       MOVE    HCM24V03            TO  RECE08-PRTDATA
                   WHEN    "HCM24V04.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM24V04
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM24V04-RENNUM
                       MOVE    HCM24V04            TO  RECE08-PRTDATA
                   WHEN    "HCM18.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM18
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM18-RENNUM
                       MOVE    HCM18               TO  RECE08-PRTDATA
                   WHEN    "HCM18V01.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM18V01
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM18V01-RENNUM
                       MOVE    HCM18V01            TO  RECE08-PRTDATA
                   WHEN    "HCM18V02.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM18V02
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM18V02-RENNUM
                       MOVE    HCM18V02            TO  RECE08-PRTDATA
                   WHEN    "HCM18V03.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM18V03
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM18V03-RENNUM
                       MOVE    HCM18V03            TO  RECE08-PRTDATA
                   WHEN    "HCM18V04.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM18V04
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM18V04-RENNUM
                       MOVE    HCM18V04            TO  RECE08-PRTDATA
                   WHEN    "HCM20.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM20
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM20-RENNUM
                       MOVE    HCM20               TO  RECE08-PRTDATA
                   WHEN    "HCM20V01.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM20V01
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM20V01-RENNUM
                       MOVE    HCM20V01            TO  RECE08-PRTDATA
                   WHEN    "HCM20V02.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM20V02
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM20V02-RENNUM
                       MOVE    HCM20V02            TO  RECE08-PRTDATA
                   WHEN    "HCM20V03.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM20V03
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM20V03-RENNUM
                       MOVE    HCM20V03            TO  RECE08-PRTDATA
                   WHEN    "HCM20V04.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM20V04
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM20V04-RENNUM
                       MOVE    HCM20V04            TO  RECE08-PRTDATA
                   WHEN    "HCM23.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM23
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM23-RENNUM
                       MOVE    HCM23               TO  RECE08-PRTDATA
                   WHEN    "HCM23V01.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM23V01
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM23V01-RENNUM
                       MOVE    HCM23V01            TO  RECE08-PRTDATA
                   WHEN    "HCM23V02.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM23V02
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM23V02-RENNUM
                       MOVE    HCM23V02            TO  RECE08-PRTDATA
                   WHEN    "HCM23V03.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM23V03
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM23V03-RENNUM
                       MOVE    HCM23V03            TO  RECE08-PRTDATA
                   WHEN    "HCM23V04.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM23V04
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM23V04-RENNUM
                       MOVE    HCM23V04            TO  RECE08-PRTDATA
                   WHEN    "HCM29.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM29
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM29-RENNUM
                       MOVE    HCM29               TO  RECE08-PRTDATA
                   WHEN    "HCM29V01.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM29V01
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM29V01-RENNUM
                       MOVE    HCM29V01            TO  RECE08-PRTDATA
                   WHEN    "HCM29V02.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM29V02
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM29V02-RENNUM
                       MOVE    HCM29V02            TO  RECE08-PRTDATA
                   WHEN    "HCM25.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM25
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM25-RENNUM
                       MOVE    HCM25               TO  RECE08-PRTDATA
                   WHEN    "HCM26.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM26
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM26-RENNUM
                       MOVE    HCM26               TO  RECE08-PRTDATA
                   WHEN    "HCN21.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN21
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN21-RENNUM
                       MOVE    HCN21               TO  RECE08-PRTDATA
                   WHEN    "HCN21V01.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN21V01
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN21V01-RENNUM
                       MOVE    HCN21V01            TO  RECE08-PRTDATA
                   WHEN    "HCN21V02.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN21V02
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN21V02-RENNUM
                       MOVE    HCN21V02            TO  RECE08-PRTDATA
                   WHEN    "HCN21V03.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN21V03
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN21V03-RENNUM
                       MOVE    HCN21V03            TO  RECE08-PRTDATA
                   WHEN    "HCN21V04.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN21V04
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN21V04-RENNUM
                       MOVE    HCN21V04            TO  RECE08-PRTDATA
                   WHEN    "HCN22.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN22
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN22-RENNUM
                       MOVE    HCN22               TO  RECE08-PRTDATA
                   WHEN    "HCN22V01.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN22V01
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN22V01-RENNUM
                       MOVE    HCN22V01            TO  RECE08-PRTDATA
                   WHEN    "HCN22V02.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN22V02
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN22V02-RENNUM
                       MOVE    HCN22V02            TO  RECE08-PRTDATA
                   WHEN    "HCN22V03.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN22V03
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN22V03-RENNUM
                       MOVE    HCN22V03            TO  RECE08-PRTDATA
                   WHEN    "HCN22V04.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN22V04
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN22V04-RENNUM
                       MOVE    HCN22V04            TO  RECE08-PRTDATA
                   WHEN    "HCN23.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN23
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN23-RENNUM
                       MOVE    HCN23               TO  RECE08-PRTDATA
                   WHEN    "HCN23V01.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN23V01
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN23V01-RENNUM
                       MOVE    HCN23V01            TO  RECE08-PRTDATA
                   WHEN    "HCN23V02.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN23V02
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN23V02-RENNUM
                       MOVE    HCN23V02            TO  RECE08-PRTDATA
                   WHEN    "HCN23V03.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN23V03
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN23V03-RENNUM
                       MOVE    HCN23V03            TO  RECE08-PRTDATA
                   WHEN    "HCN23V04.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN23V04
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN23V04-RENNUM
                       MOVE    HCN23V04            TO  RECE08-PRTDATA
                   WHEN    "HCN25.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN25
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN25-RENNUM
                       MOVE    HCN25               TO  RECE08-PRTDATA
                   WHEN    "HCM48.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM48
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM48-RENNUM
                       MOVE    HCM48               TO  RECE08-PRTDATA
                   WHEN    "HCN48.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN48
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN48-RENNUM
                       MOVE    HCN48               TO  RECE08-PRTDATA
                   WHEN    "HCM49.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCM49
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCM49-RENNUM
                       MOVE    HCM49               TO  RECE08-PRTDATA
                   WHEN    "HCN50.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN50
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN50-RENNUM
                       MOVE    HCN50               TO  RECE08-PRTDATA
                   WHEN    "HCN51.red"                  
                       MOVE    RECE08-PRTDATA      TO  HCN51
                       MOVE    WRK-HEN-RENNUM-AREA TO  HCN51-RENNUM
                       MOVE    HCN51               TO  RECE08-PRTDATA
               END-EVALUATE
           END-IF            
           MOVE    RECE08-PRTDATA      TO  PRT-PRTDATA
           WRITE   PRT-REC
      *
           ADD     1                   TO  CNT-OUT     
                                           CNT-IN-CANCEL
      *
           PERFORM 390-PRINT-OUT-SEC
      *
           PERFORM 900-RECEPRT-FET-SEC
      *
      *    処理中止設定処理
           IF      CNT-IN-CANCEL      =   50
               MOVE    ZERO               TO  CNT-IN-CANCEL 
               PERFORM 500-CANCEL-HENSYU-SEC
           END-IF
      *
           .
       2001-RECEPRT-PRINT-EXT.
           EXIT.
      *
      *****************************************************************
      *    オフセット取得処理
      *****************************************************************
       2002-OFFSET-GET-SEC             SECTION.
      *
           MOVE    SPACE               TO  SYS-1044-REC
           INITIALIZE                  SYS-1044-REC
           MOVE    "1044"              TO  SYS-1044-KANRICD
           MOVE    PRT-PRTID           TO  SYS-1044-FORMID
           STRING  PRT-PRTNM           DELIMITED  BY  SPACE
                   "%"                 DELIMITED  BY  SIZE
                                       INTO    SYS-1044-TBL(21:)
           END-STRING
           MOVE    "99999999"          TO  SYS-1044-STYUKYMD
           MOVE    "99999999"          TO  SYS-1044-EDYUKYMD
grpsys*    MOVE SPA-HOSPNUM TO -HOSPNUM
           MOVE    SYS-1044-REC        TO  MCPDATA-REC
           MOVE    "tbl_syskanri"      TO  MCP-TABLE
           MOVE    "key3"              TO  MCP-PATHNAME
           MOVE    "DBSELECT"          TO  MCP-FUNC
grpsys     CALL "ORCDBMAIN" USING MCPAREA
                                  MCPDATA-REC
grpsys                            SPA-AREA
           IF      MCP-RC              =   ZERO
               MOVE    "tbl_syskanri"  TO  MCP-TABLE
               MOVE    "key3"          TO  MCP-PATHNAME
               MOVE    "DBFETCH"       TO  MCP-FUNC
grpsys         CALL "ORCDBMAIN" USING MCPAREA
                                      MCPDATA-REC
grpsys                                SPA-AREA
               IF      MCP-RC          =   ZERO
                   MOVE  MCPDATA-REC   TO  SYS-1044-REC
                   IF   (SYS-1044-FORMID  =   PRT-PRTID)  AND
                        (SYS-1044-PRTNM   =   PRT-PRTNM)
                         CONTINUE
                   ELSE
                         INITIALIZE    SYS-1044-REC
                   END-IF
               ELSE
                   INITIALIZE          SYS-1044-REC
               END-IF
           ELSE
               INITIALIZE              SYS-1044-REC
           END-IF
           MOVE    "tbl_syskanri"      TO  MCP-TABLE
           MOVE    "key3"              TO  MCP-PATHNAME
           MOVE    "DBCLOSECURSOR"     TO  MCP-FUNC
grpsys     CALL "ORCDBMAIN" USING MCPAREA
                                  MCPDATA-REC
grpsys                            SPA-AREA
      *
           .
       2002-OFFSET-GET-EXT.
           EXIT.
      *
      *****************************************************************
      *    帳票印刷処理
      *****************************************************************
       390-PRINT-OUT-SEC                SECTION.
      *     
           INITIALIZE                  ORCSPRTAREA
           MOVE    "INS"               TO  SPRT-MODE
           MOVE    LNK-PRTKANRI-RENNUM TO  SPRT-RENNUM
           MOVE    LNK-PRTKANRI-TBL-KEY
                                       TO  SPRT-TBL-KEY
           MOVE    LNK-PRTKANRI-TBL-GROUP
                                       TO  SPRT-TBL-GROUP
           IF      WRK-PARA-SYOKBN     =   "1"
               MOVE    LNK-PRTKANRI-SRYYM  TO  SPRT-SRYYM
           ELSE
               MOVE    ZERO                TO  SPRT-SRYYM
           END-IF
           MOVE    LNK-PRTKANRI-SKYYMD TO  SPRT-SKYYMD
           MOVE    LNK-PRTKANRI-SHELLID 
                                       TO  SPRT-SHELLID
           MOVE    LNK-PRTKANRI-SHORI-RENNUM
                                       TO  SPRT-SHORI-RENNUM
           MOVE    LNK-PRTKANRI-PRIORITY
                                       TO  SPRT-PRIORITY
           MOVE    RECE08-FORMID       TO  SPRT-PRTID
           MOVE    RECE08-PRTDATA      TO  SPRT-PRTDATA
      *
         
           EVALUATE    RECE08-FORMID   ALSO    RECE08-NYUGAIKBN
               WHEN    "HC21"          ALSO    ANY 
               WHEN    "HCM21.red"     ALSO    ANY             
               WHEN    "HCM21V01.red"  ALSO    ANY
               WHEN    "HCM21V02.red"  ALSO    ANY
               WHEN    "HCM21V03.red"  ALSO    ANY
               WHEN    "HCM21V04.red"  ALSO    ANY
               WHEN    "HC22"          ALSO    ANY 
               WHEN    "HCM22.red"     ALSO    ANY
               WHEN    "HCM22V01.red"  ALSO    ANY
               WHEN    "HCM22V02.red"  ALSO    ANY
               WHEN    "HCM22V03.red"  ALSO    ANY
               WHEN    "HCM22V04.red"  ALSO    ANY
               WHEN    "HC18"          ALSO    ANY 
               WHEN    "HCM18.red"     ALSO    ANY
               WHEN    "HCM18V01.red"  ALSO    ANY
               WHEN    "HCM18V02.red"  ALSO    ANY
               WHEN    "HCM18V03.red"  ALSO    ANY
               WHEN    "HCM18V04.red"  ALSO    ANY
               WHEN    "HC20"          ALSO    ANY 
               WHEN    "HCM20.red"     ALSO    ANY
               WHEN    "HCM20V01.red"  ALSO    ANY
               WHEN    "HCM20V02.red"  ALSO    ANY
               WHEN    "HCM20V03.red"  ALSO    ANY
               WHEN    "HCM20V04.red"  ALSO    ANY
               WHEN    "HC24"          ALSO    ANY 
               WHEN    "HCM24.red"     ALSO    "2"
               WHEN    "HCM24V01.red"  ALSO    "2"
               WHEN    "HCM24V02.red"  ALSO    "2"
               WHEN    "HCM24V03.red"  ALSO    "2"
               WHEN    "HCM24V04.red"  ALSO    "2"
                   MOVE    "労災レセプト（入院外）"    TO  SPRT-TITLE
               WHEN    "HCM23.red"     ALSO    ANY
               WHEN    "HCM23V01.red"  ALSO    ANY
               WHEN    "HCM23V02.red"  ALSO    ANY
               WHEN    "HCM23V03.red"  ALSO    ANY
               WHEN    "HCM23V04.red"  ALSO    ANY
               WHEN    "HCM48.red"     ALSO    ANY
               WHEN    "HCM29.red"     ALSO    "2"
               WHEN    "HCM29V01.red"  ALSO    "2"
               WHEN    "HCM29V02.red"  ALSO    "2"
               WHEN    "HCM49.red"     ALSO    "2"
                   MOVE    "自賠責（新様式）レセプト（入院外）"
                                                       TO  SPRT-TITLE
               WHEN    "HCM25.red"     ALSO    "2"
               WHEN    "HCM26.red"     ALSO    "2"
                   MOVE    "自賠責（従来様式）レセプト（入院外）"
                                                       TO  SPRT-TITLE
               WHEN    "HCN21.red"     ALSO    ANY
               WHEN    "HCN21V01.red"  ALSO    ANY
               WHEN    "HCN21V02.red"  ALSO    ANY
               WHEN    "HCN21V03.red"  ALSO    ANY
               WHEN    "HCN21V04.red"  ALSO    ANY
               WHEN    "HCN22.red"     ALSO    ANY
               WHEN    "HCN22V01.red"  ALSO    ANY
               WHEN    "HCN22V02.red"  ALSO    ANY
               WHEN    "HCN22V03.red"  ALSO    ANY
               WHEN    "HCN22V04.red"  ALSO    ANY
               WHEN    "HCN50.red"     ALSO    ANY
               WHEN    "HCN51.red"     ALSO    ANY
               WHEN    "HCM24V01.red"  ALSO    "1"
               WHEN    "HCM24V02.red"  ALSO    "1"
               WHEN    "HCM24V03.red"  ALSO    "1"
               WHEN    "HCM24V04.red"  ALSO    "1"
                   MOVE    "労災レセプト（入院）"      TO  SPRT-TITLE
               WHEN    "HCN23.red"     ALSO    ANY
               WHEN    "HCN23V01.red"  ALSO    ANY
               WHEN    "HCN23V02.red"  ALSO    ANY
               WHEN    "HCN23V03.red"  ALSO    ANY
               WHEN    "HCN23V04.red"  ALSO    ANY
               WHEN    "HCN48.red"     ALSO    ANY
               WHEN    "HCM29.red"     ALSO    "1"
               WHEN    "HCM29V01.red"  ALSO    "1"
               WHEN    "HCM29V02.red"  ALSO    "1"
               WHEN    "HCM49.red"     ALSO    "1"
                   MOVE    "自賠責（新様式）レセプト（入院）"
                                                       TO  SPRT-TITLE
               WHEN    "HCN25.red"     ALSO    "1"
               WHEN    "HCM26.red"     ALSO    "1"
                   MOVE    "自賠責（従来様式）レセプト（入院）"
                                                       TO  SPRT-TITLE
           END-EVALUATE
           MOVE    LNK-PRTKANRI-TERMID TO  SPRT-TERMID
           MOVE    LNK-PRTKANRI-OPID   TO  SPRT-OPID
           MOVE    RECE08-PRTNM        TO  SPRT-PRTNM
           MOVE    "1"                 TO  SPRT-SITEKBN
           MOVE    "1"                 TO  SPRT-PRTFLG
           CALL    "ORCSPRT"           USING
                                       ORCSPRTAREA
           IF      SPRT-RETURN         =   ZERO
               CONTINUE
           ELSE
               MOVE    "印刷ＤＢに更新できませんでした"
                                          TO  WRK-RECEERR
               PERFORM 500-ERR-HENSYU-SEC                           
           END-IF                                                              
           .
       390-PRINT-OUT-EXT.
           EXIT.
      *
      *****************************************************************
      *    帳票クリア処理
      *****************************************************************
       2002-RECEPRT-CLEAR-SEC          SECTION.
      *
      *    出力順エリアのクリア
           MOVE    ZERO                 TO  RECE08-PRTJYUN-SYUKA
           MOVE    ZERO                 TO  RECE08-PRTRENNUM     
           MOVE    SPACE                TO  RECE08-PRTNM
      *
grpsys*    MOVE SPA-HOSPNUM TO -HOSPNUM
           MOVE    RECE08-REC           TO  MCPDATA-REC
           MOVE    "RECEPRT-KEY"        TO  ORC-DBPATH
           MOVE    "DBUPDATE"           TO  MCP-FUNC
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
      *
           IF      MCP-RC             =   ZERO
               PERFORM 900-RECEPRT-FET-SEC
           ELSE
               MOVE    "帳票ＤＢの更新でエラーになりました"
                                          TO  WRK-RECEERR
               PERFORM 500-ERR-HENSYU-SEC
          END-IF    
           .
       2001-RECEPRT-CLEAR-EXT.
           EXIT.
      *
      *
      *****************************************************************
      *    エラー出力処理
      *****************************************************************
       500-ERR-HENSYU-SEC                SECTION.
      *
           OPEN    INPUT   RECEERR-FILE
           IF      STS-RECEERR         =   ZERO
               CLOSE   RECEERR-FILE
           ELSE
               OPEN    OUTPUT              RECEERR-FILE
      *
               MOVE    WRK-RECEERR         TO  RECEERR-REC
               WRITE   RECEERR-REC
               CLOSE   RECEERR-FILE
      *         
      *        ジョブ管理開始処理
               MOVE    "JBE"           TO  SJOBKANRI-MODE
               INITIALIZE                  JOBKANRI-REC
               MOVE    WRK-PARA-JOBID  TO  JOB-JOBID
               MOVE    WRK-PARA-SHELLID
                                       TO  JOB-SHELLID
               MOVE    WRK-RECEERR     TO  JOB-YOBI
               MOVE    "9999"          TO  JOB-ERRCD
               CALL    "ORCSJOB"       USING
                                       ORCSJOBKANRIAREA  
                                       JOBKANRI-REC
           END-IF
      *
           MOVE    1                   TO  FLG-END     
      *
           .
       500-ERR-HENSYU-EXT.
           EXIT.
      *
      *****************************************************************
      *    処理中止処理
      *****************************************************************
       500-CANCEL-HENSYU-SEC                SECTION.
      *
           MOVE    "CHK"           TO  SJOBKANRI-MODE
           INITIALIZE                  JOBKANRI-REC
           MOVE    WRK-PARA-JOBID  TO  JOB-JOBID
           MOVE    WRK-PARA-SHELLID
                                   TO  JOB-SHELLID
           CALL    "ORCSJOB"       USING
                                   ORCSJOBKANRIAREA  
                                   JOBKANRI-REC
           IF    ( SJOBKANRI-RETURN
                                   =   ZERO )
           AND   ( JOB-STOPFLG     >   ZERO )
               MOVE    "処理が中止されました"
                                           TO  WRK-RECEERR
      *
               OPEN    INPUT   RECEERR-FILE
               IF      STS-RECEERR         =   ZERO
                   CLOSE   RECEERR-FILE
               ELSE
                   OPEN    OUTPUT              RECEERR-FILE
      *    
                   MOVE    WRK-RECEERR         TO  RECEERR-REC
                   WRITE   RECEERR-REC
                   CLOSE   RECEERR-FILE
      *         
                   IF      JOB-STOPFLG     =   1
      *                ジョブ管理終了処理
                       MOVE    "CA2"           TO  SJOBKANRI-MODE
                       INITIALIZE                  JOBKANRI-REC
                       MOVE    WRK-PARA-JOBID  TO  JOB-JOBID
                       MOVE    WRK-PARA-SHELLID
                                               TO  JOB-SHELLID
                       MOVE    WRK-RECEERR     TO  JOB-YOBI
                       MOVE    "8888"          TO  JOB-ERRCD
                       MOVE    2               TO  JOB-STOPFLG
                       CALL    "ORCSJOB"       USING
                                               ORCSJOBKANRIAREA  
                                               JOBKANRI-REC
                   END-IF
               END-IF
      *                             
               MOVE    1                   TO  FLG-END
           END-IF
           .
       500-CANCEL-HENSYU-EXT.
           EXIT.
      *
      *****************************************************************
      *    終了　　処理
      *****************************************************************
       300-END-SEC                 SECTION.
      *     
      *    ステップ管理終了処理
           MOVE    "STE"           TO  SJOBKANRI-MODE
           INITIALIZE                  JOBKANRI-REC
           MOVE    WRK-PARA-JOBID  TO  JOB-JOBID
           MOVE    WRK-PARA-SHELLID
                                   TO  JOB-SHELLID
           MOVE    CNT-OUT         TO  JOB-UPDCNT                         
           CALL    "ORCSJOB"       USING
                                   ORCSJOBKANRIAREA  
                                   JOBKANRI-REC
      *
           PERFORM 900-DBDISCONNECT-SEC
      *
           DISPLAY "*** ORCR0500 IN  "  CNT-IN
           DISPLAY "*** ORCR0500 OUT "  CNT-OUT
      **** DISPLAY "*** ORCR0500 END ***"
      *****ACCEPT WRK-IN
           .
       300-END-EXT.
           EXIT.
      *
      *****************************************************************
      *     レセプト管理を主キーで読み込む
      *****************************************************************
       900-RECEPRT-SELECT-SEC          SECTION.
      *
           INITIALIZE                  RECE08-REC
           MOVE    WRK-PARA-RECE09-PRTID    TO  RECE08-PRTID
      *****MOVE    WRK-PARA-RECE09-SRYYM    TO  RECE08-SRYYM
           MOVE    WRK-PARA-RECE09-SRYYM    TO  RECE08-RECEYM
           MOVE    WRK-PARA-RECE09-CREYMD   TO  RECE08-CREYMD
           MOVE    WRK-PARA-RECE09-CREHMS   TO  RECE08-CREHMS
           MOVE    WRK-PARA-RECE09-NYUGAIKBN
                                            TO  RECE08-NYUGAIKBN
      *
grpsys*    MOVE SPA-HOSPNUM TO -HOSPNUM
           MOVE    RECE08-REC          TO  MCPDATA-REC
           MOVE    WRK-PATH            TO  ORC-DBPATH
           MOVE    "DBSELECT"          TO  MCP-FUNC
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
      *
      *
      *    エラーチェック
           IF      MCP-RC             =   ZERO
               PERFORM 900-RECEPRT-FET-SEC
           ELSE 
               DISPLAY "*** ORCR0500 SELECT ERR " MCP-RC 
               MOVE    1                   TO  FLG-RECEPRT
           END-IF
           .
       900-RECEPRT-SELECT-EXT.
           EXIT.
      *
      *****************************************************************
      *     入力コードマスタを主キーより検索処理
      *****************************************************************
       900-RECEPRT-FET-SEC            SECTION.
      *
           MOVE    WRK-PATH            TO  ORC-DBPATH
           MOVE    "DBFETCH"           TO  MCP-FUNC
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
      *                                  
           IF      MCP-RC              =   ZERO
               MOVE    MCPDATA-REC     TO  RECE08-REC
               ADD     1               TO  CNT-IN
               MOVE    ZERO            TO  FLG-RECEPRT
           ELSE
               MOVE    1               TO  FLG-RECEPRT
           END-IF
           .
       900-RECEPRT-FET-EXT.
           EXIT.
      *
      *******************************************************
      *     入力コードマスター クロース１処理
      *****************************************************************
       900-RECEPRT-CLS-SEC            SECTION.
      *
           MOVE    WRK-PATH            TO  ORC-DBPATH
           MOVE    "DBCLOSECURSOR"     TO  MCP-FUNC
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
           .
       900-RECEPRT-CLS-EXT.
           EXIT.
      *
      *****************************************************************
      *    管理マスタ読み込み
      *****************************************************************
       800-SYSKANRI-READ-SEC           SECTION.
      *
           MOVE    WRK-PARA-SRYYM      TO  ORC-DBYMD (1:6)
           MOVE    "01"                TO  ORC-DBYMD (7:2)
           MOVE    "DBSELECT"          TO  MCP-FUNC
           MOVE    "SYSKANRI-KEY"      TO  ORC-DBPATH
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
           IF      MCP-RC              =   ZERO
               MOVE    "DBFETCH"           TO  MCP-FUNC
               MOVE    "SYSKANRI-KEY"      TO  ORC-DBPATH
               CALL    "ORCMCPSUB"          USING
                                            MCPAREA
                                            ORCMCPAREA
                                            MCPDATA-REC
               IF      MCP-RC              =   ZERO
                   MOVE    ZERO            TO  FLG-SYSKANRI
               ELSE
                   MOVE    1               TO  FLG-SYSKANRI
               END-IF
           ELSE
               MOVE    1               TO  FLG-SYSKANRI
           END-IF
      *
           MOVE    "DBCLOSECURSOR"     TO  MCP-FUNC
           MOVE    "SYSKANRI-KEY"      TO  ORC-DBPATH
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
      *
           .
       800-SYSKANRI-READ-EXT.
           EXIT.
      *      
      *****************************************************************
      *    ＤＢ　オープン処理
      *****************************************************************
       100-DBOPEN-SEC                SECTION.
      *
           MOVE    "DBOPEN"            TO  MCP-FUNC.
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC.
      *
           MOVE    "DBSTART"           TO  MCP-FUNC.
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC.
           .
       100-DBOPEN-EXT.
           EXIT.
      *
      *****************************************************************
      *    ＤＢ　クローズ処理
      *****************************************************************
       900-DBDISCONNECT-SEC            SECTION.
      *
           MOVE    "DBCOMMIT"          TO  MCP-FUNC.
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC.
      *
           MOVE    "DBDISCONNECT"      TO  MCP-FUNC.
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC.
      *
           .
       900-DBDISCONNECT-EXT.
           EXIT.
