prefix = @prefix@
exec_prefix= @exec_prefix@

sysconfdir = @sysconfdir@

docdir = ${prefix}/doc

datadir = ${exec_prefix}/data
formdir = ${exec_prefix}/form
initdir = ${exec_prefix}/init
lddefdir = ${exec_prefix}/lddef
recorddir = ${exec_prefix}/record
screendir = ${exec_prefix}/screen
scriptsdir = ${exec_prefix}/scripts
copydir = ${exec_prefix}/cobol/copy
libdir  = @libdir@

srcdir = @srcdir@

COBOL = @COBC@
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
MKDIR = mkdir -p

COBCOPYS = -I$(srcdir)/../../cobol/copy

COBOLFLAGS =  -m -dynamic 
EXEC_COBOLFLAGS = -dynamic 
DEPDIR = .deps

OBJS = ${SRCS:.CBL=.so}
EXEC = ${EXEC_SRCS:.CBL=}

define postprocess-depend
@if test ! -d $(DEPDIR); then mkdir $(DEPDIR); fi
endef

%.so: %.CBL
	$(postprocess-depend)
	$(COBOL) $(COBOLFLAGS)  $(COBCOPYS)  -MT $@ -MF $(DEPDIR)/${@:.so=.Po} $< 
	
%: %.CBL
	$(postprocess-depend)
	$(COBOL) $(EXEC_COBOLFLAGS) $(COBCOPYS) -MT $@ -MF $(DEPDIR)/${@:=.Po} $<

all: $(OBJS) $(EXEC)

clean: 
	-rm -f $(OBJS) $(EXEC)

distclean: 
	-rm -f $(OBJS) $(EXEC)
	-rm -R $(DEPDIR)

-include $(wildcard $(DEPDIR)/*.Po) /dev/null
