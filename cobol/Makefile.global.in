COBOL = @COBC@
INSTALL = @INSTALL@
MKDIR = mkdir -p
COBOLFLAGS =  -m -dynamic
EXEC_COBOLFLAGS = -dynamic
DEPDIR = .deps
prefix = @prefix@
exec_prefix= @exec_prefix@
orcadir = ${exec_prefix}/orca
libdir  = ${orcadir}/lib
copydir = ../copy

OBJS = ${SRCS:.CBL=.so}
EXEC = ${EXEC_SRCS:.CBL=}

define postprocess-depend
@if test ! -d $(DEPDIR); then mkdir $(DEPDIR); fi
endef

%.so: %.CBL
	$(postprocess-depend)
	$(COBOL) $(COBOLFLAGS) -I $(copydir) -MT $@ -MF $(DEPDIR)/${@:.so=.Po} $< 
	
%: %.CBL
	$(postprocess-depend)
	$(COBOL) $(EXEC_COBOLFLAGS) -I $(copydir) -MT $@ -MF $(DEPDIR)/${@:=.Po} $<

all: $(OBJS) $(EXEC)

clean: 
	-rm -f $(OBJS) $(EXEC)

distclean: 
	-rm -f $(OBJS) $(EXEC)
	-rm -R $(DEPDIR)


install: all
	-@if [ ! -d $(libdir) ]; then \
	  $(MKDIR) $(libdir); \
	fi
	for f in $(OBJS); do \
	  $(INSTALL) -m 555 $${f} $(libdir) ; done

-include $(wildcard $(DEPDIR)/*.Po) /dev/null
