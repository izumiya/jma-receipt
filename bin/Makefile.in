top_srcdir = @top_srcdir@
include $(top_srcdir)/Makefile.directories

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_SCRIPT = @INSTALL_SCRIPT@

BIN_sources = \
	jma-receipt-db-setup.sh.in \
	jma-receipt-db-check.sh.in \
	jma-receipt-sysbase-setup.sh.in \
	jma-dbsync.sh.in \
	jma-dbconvert.sh.in \
	jma-backupcluster.sh.in \
	jma-restorecluster.sh.in \
	jma-receipt-program-upgrade-check.sh.in \
	jma-receipt-program-upgrade.sh.in \
	orcvt_exec.sh.in \
	create_dbgroup.sh.in

BIN_cmdsrc = jma-setup.in
BIN_cmd = jma-setup

BIN_bin = \
	orcvt_euc.rb \
	orcvt_euc_kananame.rb \
	jma-plugin \
	convu8.rb

BIN_objs = $(BIN_sources:.sh.in=.sh) \
           $(BIN_cmd)

BIN_files = $(BIN_objs) $(BIN_bin) $(BIN_cmd)

.SUFFIXES: .sh.in .sh

all:	$(BIN_objs)

.sh.in.sh:
	sed -e 's,\@jma-receipt-env\@,$(sysconfdir)\/jma-receipt\.env,g' \
	    -e 's,\@VERSION\@,$(VERSION),g' \
	$< > $@
	chmod +x $@

$(BIN_cmd): $(BIN_cmdsrc)
	sed -e 's,\@bindir\@,$(bindir),g' \
	$(BIN_cmdsrc) > $@
	chmod +x $@

filecheck:

clean:
	-rm -f $(BIN_objs)

distclean: clean
	-rm -f Makefile

install: all
	$(INSTALL) -d $(bindir)
	$(INSTALL_SCRIPT) $(BIN_files) $(bindir)
