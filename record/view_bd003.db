view_bd003 {

#   SKYMONEY,NYUHEN_MONEYは
#   集計に使いたいので10桁とっておく


	HOSPID				char(24);
	NYUGAIKBN			char(1);
	PTID				number(10,0);
	DENPNUM          	number(7,0);
	DENPEDANUM			number(2,0);
	SKYMONEY			number(10,0);
	NYUHEN_MONEY		number(10,0);
	NYUHEN_YMD			char(8);
	SRYYMD              char(8);
};

path	key 	{
	DBSELECT	{
		DECLARE view_bd003_key_csr CURSOR FOR
		SELECT PTID,SUM(SKYMONEY) AS SKYMONEY,SUM(NYUHEN_MONEY) AS NYUHEN_MONEY
		FROM view_bd003
		WHERE	HOSPID             = :HOSPID
		AND	    (SRYYMD BETWEEN :SRYYMD  AND :NYUHEN_YMD )
		GROUP BY PTID HAVING SUM(SKYMONEY) <> SUM(NYUHEN_MONEY)
		;
	};
};

path	key2 	{
	DBSELECT	{
		DECLARE view_bd003_key2_csr CURSOR FOR
		SELECT PTID,SUM(SKYMONEY) AS SKYMONEY,SUM(NYUHEN_MONEY) AS NYUHEN_MONEY
		FROM view_bd003
		WHERE	HOSPID             = :HOSPID
		AND		NYUHEN_YMD        <= :NYUHEN_YMD
		AND		(SRYYMD BETWEEN :SRYYMD  AND :NYUHEN_YMD )
		GROUP BY PTID HAVING SUM(SKYMONEY) <> SUM(NYUHEN_MONEY)
		;
	};
};


path	key3 	{
	DBSELECT	{
		DECLARE view_bd003_key3_csr CURSOR FOR
		SELECT  HOSPID,NYUGAIKBN,PTID,DENPNUM
		       ,SUM(SKYMONEY) AS SKYMONEY,SUM(NYUHEN_MONEY) AS NYUHEN_MONEY
		FROM view_bd003
		WHERE	HOSPID             = :HOSPID
		AND		NYUGAIKBN          = :NYUGAIKBN
		AND		(SRYYMD BETWEEN :SRYYMD  AND :NYUHEN_YMD )
		GROUP BY HOSPID,NYUGAIKBN,PTID,DENPNUM
		HAVING  SUM(SKYMONEY) <> SUM(NYUHEN_MONEY)
		;
	};
};

path	key4 	{
	DBSELECT	{
		DECLARE view_bd003_key4_csr CURSOR FOR
		SELECT  HOSPID,NYUGAIKBN,PTID,DENPNUM
		       ,SUM(SKYMONEY) AS SKYMONEY,SUM(NYUHEN_MONEY) AS NYUHEN_MONEY
		FROM view_bd003
		WHERE	HOSPID             = :HOSPID
		AND		NYUGAIKBN          = :NYUGAIKBN
		AND     NYUHEN_YMD        <= :NYUHEN_YMD
		AND		(SRYYMD BETWEEN :SRYYMD  AND :NYUHEN_YMD )
		GROUP BY HOSPID,NYUGAIKBN,PTID,DENPNUM
		HAVING  SUM(SKYMONEY) <> SUM(NYUHEN_MONEY)
		;
	};
};

